<!-- Specific page to create new journalz: name, description -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <title>Journalz - Create a new Journalz</title>

    <!-- Styles -->
    <link href="assets/css/page.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/custom.css">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="assets/img/apple-touch-icon.png">
    <link rel="icon" href="assets/img/favicon.png">

    <!--  Open Graph Tags -->
    <meta property="og:title" content="TheSaaS">
    <meta property="og:description" content="A responsive, professional, and multipurpose SaaS, Software, Startup and WebApp landing template powered by Bootstrap 4.">
    <meta property="og:image" content="http://thetheme.io/thesaas/assets/img/og-img.jpg">
    <meta property="og:url" content="http://thetheme.io/thesaas/">
    <meta name="twitter:card" content="summary_large_image">
  </head>

  <!-- ALL CDNs -->
    <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="/__/firebase/7.14.2/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="/__/firebase/7.14.2/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-firestore.js"></script>

  <!-- Initialize Firebase -->
  <!-- <script src="/__/firebase/init.js"></script> -->
  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBzS-Jv_3e29tI6GY7wO50PqOAPa2nqY6Y",
      authDomain: "online-journal-3622d.firebaseapp.com",
      databaseURL: "https://online-journal-3622d.firebaseio.com",
      projectId: "online-journal-3622d",
      storageBucket: "online-journal-3622d.appspot.com",
      messagingSenderId: "55996362881",
      appId: "1:55996362881:web:9d333dc09360ceae021d80",
      measurementId: "G-YQWH5KGL87"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
  </script>
  <!-- JQUERY CDN -->
  <script src="https://code.jquery.com/jquery-3.5.0.js" integrity="sha256-r/AaFHrszJtwpe+tHyNi/XCfMxYpbsRg2Uqn0x3s2zc=" crossorigin="anonymous"></script>

  <body>


    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-stick-dark" data-navbar="sticky">
      <div class="container">

        <div class="navbar-left">
          <button class="navbar-toggler" type="button">&#9776;</button>
          <a class="navbar-brand" href="index.html">
            <img class="logo-dark" src="assets/img/logo-dark.png" alt="logo">
            <img class="logo-light" src="assets/img/logo-light.png" alt="logo">
          </a>
        </div>

        <section class="navbar-mobile">
          <span class="navbar-divider d-mobile-none"></span>

          <nav class="nav nav-navbar">
            <a class="nav-link" href="createjournalz.html" id="createjournalz">Create a new Journalz</a>
            <a class="nav-link" href="myjournalz" id="myjournalz" >My Journalz</a>
          </nav>
        </section>

        <a class="btn btn-sm btn-round btn-light" id="glogin">Login with google</a>
        <a class="btn btn-sm btn-round btn-light" id="email" style="display : none;"></a>
        <div class="divider"><a class="btn btn-sm btn-round btn-dark" id="glogout" style="display: none;">Logout</a></div>
        
        

      </div>
    </nav><!-- /.navbar -->


    <!-- Header -->
    <header class="header text-white pt-12 pb-10" style="background-image: linear-gradient(-45deg, #667eea 0%, #764ba2 100%);">
      <div class="container">
        <h1 class="display-4"><b>Journalz</b></h1>
        <p class="lead-2 mt-6">Create your day to day journal in a few clicks.</p>
      </div>
    </header><!-- /.header -->


    <!-- Main Content -->
    <main class="main-content">
      <section class="section">
        <div class="container">
          <header class="section-header">
            <h1  style="text-align: center;">Create a new Journalz</h1>
          </header>
            <div style="text-align: center; margin-right: 10%; margin-left: 10%">
                <br>
                Journalz Name:
                <br>
                <input class="form-control form-control-lg" type="text" name="journalzName" id="journalzName" style="text-align: center; border-color: grey;" placeholder="Enter your chosen Journalz name ...">
                <br>
                <br>
                Description:
                <br>
                <textarea class="form-control form-control-lg" name="description" id="description" style="border-color: grey; height: 200px;" placeholder="Enter a brief description of your Journalz..."></textarea>
                <input type="hidden" name="uid" id="uid">
                <br>
                <br>
    
                <button class="btn btn-lg btn-primary" id="createJournalZBtn">Submit</button>
                <div style="text-align: center;">
                  <div id="loader" class="loader" style="display:none; text-align: center;"></div>
                </div>
            </div>
          
        </div>
      </section>
    </main>


    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row gap-y align-items-center">

          <div class="col-6 col-lg-3">
            <a href="index.html"><img src="assets/img/logo-dark.png" alt="logo"></a>
          </div>

          <div class="col-6 col-lg-3 text-right order-lg-last">
            <div class="social">
              <a class="social-facebook" href="https://www.facebook.com/thethemeio"><i class="fa fa-facebook"></i></a>
              <a class="social-twitter" href="https://twitter.com/thethemeio"><i class="fa fa-twitter"></i></a>
              <a class="social-instagram" href="https://www.instagram.com/thethemeio/"><i class="fa fa-instagram"></i></a>
              <a class="social-dribbble" href="https://dribbble.com/thethemeio"><i class="fa fa-dribbble"></i></a>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="nav nav-bold nav-uppercase nav-trim justify-content-lg-center">
              <a class="nav-link" href="#">About</a>
              <a class="nav-link" href="#">Blog</a>
              <a class="nav-link" href="#">Policy</a>
              <a class="nav-link" href="#">Contact</a>
            </div>
          </div>

        </div>
      </div>
    </footer><!-- /.footer -->


    <!-- Scripts -->
    <script src="assets/js/page.min.js"></script>
    <script>
    var db = firebase.firestore();
    var uid;

    firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
              uid = user.uid;
              $("#glogin").hide(); // hide the login button
              document.getElementById("email").innerHTML = user.email;
              $("#email").show(); // show your email
              $("#glogout").show(); // logout logo
              $("#createjournalz").show(); //Hyperlink to get to the other html createJournalz
              $("#myjournalz").show(); // Show your journalz in another page
              $("#uid").val(uid);
          } else {
              // No user is signed in.
          }
      });


// login through google auth popup
    $("#glogin").click(function() {
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider).then(function(result) {
      // This gives you a Google Access Token. You can use it to access the Google API.
      var token = result.credential.accessToken;
      // The signed-in user info.
      var user = result.user;
      $("#glogin").hide();
      document.getElementById("email").innerHTML = user.email;
      $("#email").show();
      $("#glogout").show();
      $("#createjournalz").show();
      $("#myjournalz").show();

      if (user.emailVerified === true) {
        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
            .then(function () {
                return firebase.auth().signInWithEmailAndPassword(email, password);
            })
            .catch(function (error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
            });
      }

      var docRef = db.collection("users").doc(user.uid);
      docRef.get().then(function(doc) {
        if(!doc.exists) {
          docRef.set({
            displayName: user.displayName,
            email: user.email
          }).then(function() {
            console.log("Document successfully written!");
          })
          .catch(function(error) {
              console.error("Error writing document: ", error);
          });
        }
      }).catch(function(error) {
        console.log("Error getting document:", error);
      });



    }).catch(function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;
      // The email of the user's account used.
      var email = error.email;
      // The firebase.auth.AuthCredential type that was used.
      var credential = error.credential;
      // ...
    });
    });

// logout 
    $("#glogout").click(function() {
      firebase.auth().signOut().then(function() {
          // Sign-out successful.
          $("#glogout").hide();
          $("#email").hide();
          $("#glogin").show();
          $("#createjournalz").hide();
          $("#myjournalz").hide();


      }, function(error) {
          // An error happened.
          console.log(error);
      });
    });


    $("#createJournalZBtn").click(function(e) {
      $("#createJournalZBtn").hide();
      $("#loader").show();
      if($("#uid").val()) {
        var uid = $("#uid").val();
        var formdata = {
          journalzName: $("#journalzName").val(),
          description: $("#description").val()
        }

        db.collection("users").doc(uid).collection("myjournalz").doc(formdata.journalzName).get().then(function(doc) {
          if(doc.exists) {
            alert("The Journalz name " + formdata.journalzName + "is already used.");
            $("#createJournalZBtn").show();
            $("#loader").hide();
          }
          else {
            db.collection("users").doc(uid).collection("myjournalz").doc(formdata.journalzName).set({"description": formdata.description})
            .then(function(docRef) {
              alert("Your Journalz has been successfully created.");
              $("#createJournalZBtn").show();
              $("#loader").hide();
            })
            .catch(function(error) {
              console.log(error);
              $("#createJournalZBtn").show();
              $("#loader").hide();
            });
          }
        });
      }
      else {
        alert("You are not logged in!");
        $("#createJournalZBtn").show();
        $("#loader").hide();
      }


    
    });


  </script>


    <style>
      .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 120px;
        height: 120px;
        -webkit-animation: spin 2s linear infinite; /* Safari */
        animation: spin 2s linear infinite;
      }

      /* Safari */
      @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>


  </body>
</html>
